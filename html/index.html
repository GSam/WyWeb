<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8" />
      <title>Whiley on the Web!</title>
      <link rel="stylesheet" href="css/style.css">
      <link href="css/bootstrap.min.css" rel="stylesheet">
      <link rel="shortcut icon" href="http://whiley.org/wp-content/themes/atahualpa351/images/favicon/whileyfav.ico" />
      <link rel="stylesheet" href="css/jstree.css">
      <script type="text/javascript" src="js/jquery.js"></script>
      <script type="text/javascript" src="js/jquery-ui.js"></script>
      <script type="text/javascript" src="require.js"></script>
	  <script src="js/ace.js" type="text/javascript" charset="utf-8"></script>

      <script type="text/javascript" src="js/jstree.js"></script>
      <script type="text/javascript">
         var root_url = "${ROOT_URL}";
         var error = "${ERROR}";
         var redirect = "${REDIRECT}";
         var isLoggedIn = ${"true" if LOGGED else "false"};
         var serverFiles = ${FILES};
         var loggedStorage = undefined;

      </script>
      <style>
      .ide-menu td {
      padding-left:8px;
      padding-right:8px;
      padding-top:3px;
       padding-bottom:3px;
      border-left:1px solid #dddddd;
      border-top:1px solid #dddddd;
      }
      </style>
      <script type="text/javascript" src="js/whileyweb.js"></script>
      <script type="text/javascript" src="js/ext-searchbox.js"></script>
       <script>
function newFile() {
}

function newProject() {
}

function saveAll() {
}

function commentCode() {
        editor.toggleCommentLines();
	editor.focus();
}

function indentBlock() {
    editor.blockIndent();
	editor.focus();
}

function outdentBlock() {
	editor.blockOutdent();
	editor.focus();
}

function undo() {
    if (_newFile) {
        _newFile = false;
        editor.getSession().getUndoManager().reset()
    }
	editor.undo();
	editor.focus();
}

function redo() {
	editor.redo();
	editor.focus();
}

function foldAll() {
	Folding.foldAll();
	editor.focus();
}

function gotoLine() {

    editor.execCommand("gotoline");
	editor.focus();
}

function find() {
    editor.execCommand("find");
	editor.focus();
}

function replace() {
    editor.execCommand("replace");
	editor.focus();
}

function macroRecord() {
    var image = $("#macro_recorder").attr("src");
    if (image === "images/record_on.png") {
        $("#macro_recorder").attr("src","images/record.png");
    }else{
        $("#macro_recorder").attr("src","images/record_on.png");
    }
    editor.commands.toggleRecording(editor);
    editor.focus();
}

function macroPlay() {
    var image = $("#macro_recorder").attr("src");
    if (image === "images/record_on.png") {
        $("#macro_player").attr("src","images/play.png");
    }else{
        $("#macro_player").attr("src","images/play_on.png");
    }
    editor.commands.replay(editor);
    editor.focus();
}

</script>
   </head>
   <body>

      <div class="container-fluid content">
      <div class="col-md-1">
      </div>
      <div class="col-md-10">
         <div class="container-fluid" id="container">
            <div class="row topbar">
               <div class="col-md-1">
                  <img src="images/wylogo.png" class="image-responsive"/>
               </div>
               <div class="col-md-11">
                  <p>
                  <h1>Whiley <span id="bold">PLAY</span><br/>
                     <small>From this page, you can run Whiley programs in your browser!  For more on Whiley, visit <a href="http://whiley.org">whiley.org</a>.</small>
                  </h1>
                  </p>
               </div>
            </div>
            <div class="row">
               <nav class="navbar navbar-default" role="navigation">
                  <div class="container-fluid">
                     <form class="navbar-form navbar-left">
                        <div class="form-group">
   			              <button type="button"  class="btn" onClick="save();" title="Create a permalink of this program to share with others.">Share</button>
                        % if LOGGED is True:
                          <button type="button" class="btn btn-primary" onClick="saveToServer();" title="Save your project online.">Save</button>
                        % endif
   			               <button type="button"  class="btn btn-primary" onClick="compile();" title="Compile your program to check it is correct.">Compile</button>
   			              <button type="button"  class="btn btn-primary" onClick="run();" title="Run your program to produce some output!">Run</button>
   			              <!--<a href="admin" class="btn btn-primary" title="Admin">Admin</a>-->
   			              <label class="checkbox inline">
   			        				<input id="verification" type="checkbox" checked="checked" title="Enable or disable compile-time verification" /> Enable Verification
   			    			  </label>
                        </div>
   		            </form>
                     % if LOGGED is True:
                        % if ADMIN is True:
                           <form class="navbar-form navbar-right"  action="/admin">
                              <button type="submit" class="btn btn-default">Admin</button>
                           </form>
                        % endif
                        <form class="navbar-form navbar-right"  method="post" action="/auth/logout" role="login">
                           <button type="submit" class="btn btn-default">Log out</button>
                        </form>

                        <p class="navbar-text navbar-right">Logged in as <a href="#" class="navbar-link">${USERNAME}(${USERID})</a></p>
                     % else:
                        <div class="navbar-right">
                        <form class="navbar-form"  method="post" action="/auth/login" role="login">
                           <div class="form-group">
                              <input type="text" class="form-control" placeholder="Username" name="user">
                              <input type="password" class="form-control" placeholder="Password" name="passwd">
                              <input type="hidden" name="from_page" value="/" />
                           </div>
                           <button type="submit" class="btn btn-default">Log In</button>
                              <a type="submit" class="btn btn-default" href="/auth/signup">Sign Up</a>
                        </form>
                        </div>

                     % endif

                  </div>
                  <!-- /.container-fluid -->
               </nav>
            </div>
            <div class="row">
              <div class="container-fluid" id="content">
           		 <div id="ide" class="col-md-2">
                  	<div class="file-browser" style="overflow:auto;">
	                     <div id="file-browser">
								</div>
                     </div>
                    <nav>
                        <button class="btn" onclick="addProject()" title="Create a Project...">+</button>
                    </nav>
                </div>
                  <div>
                      <table class="ide-menu">
                          <tr>

                              <td style="z-index: 100">
                                  <a href=" javascript:newFile();">
                                      <img src="images/new_file.png" border="0" alt="Add New File" title="New File">
                                  </a>
                              </td>
                              <td>
                                  <a href=" javascript:addProject();">
                                      <img src="images/new_project.png" border="0" alt="Create New Project" title="New Project">
                                  </a>
                              </td>
                              <td>
                        % if LOGGED is False:
                                  <img src="images/save.png" border="0" alt="Save All Files" title="Saving Is Only Available To Logged In Users" style="opacity:0.4">
                        % endif
                        % if LOGGED is True:
                                  <a href=" javascript:saveToServer();editor.focus();">
                                      <img src="images/save.png" border="0" alt="Save All Files" title="Save All Files">
                                  </a>
                        % endif
                              </td>
                              <td>
                                  <a href=" javascript:compile();">
                                      <img src="images/compile.png" border="0" alt="Compile This Project" title="Compile">
                                  </a>
                              </td>
                              <td>
                                  <a href=" javascript:run();">
                                      <img src="images/run.png" border="0" alt="Run This Project" title="Run">
                                  </a>
                              </td>
                              <td>

                                  <a href=" javascript:commentCode();">
                                      <img src="images/comments.png" border="0" alt="comment selected text" title="Comment selected text">
                                  </a>
                              </td>
                              <td>
                                  <a href=" javascript:indentBlock();">
                                      <img src="images/indent.png" border="0" alt="Indent selected text" title="Indent selected text">
                                  </a>
                              </td>
                              <td>
                                  <a href=" javascript:outdentBlock();">
                                      <img src="images/outdent.png" border="0" alt="Outdent selected text" title="Outdent selected text">
                                  </a>
                              </td>

                              <td>
                                  <a href=" javascript:undo();">
                                      <img src="images/undo.png" border="0" alt="Undo" title="Undo">
                                  </a>
                              </td>
                              <td>
                                  <a href=" javascript:redo();">
                                      <img src="images/redo.png" border="0" alt="Redo" title="Redo">
                                  </a>
                              </td>
                              <td>
                                  <a href=" javascript:gotoLine();">
                                      <img src="images/goto.png" border="0" alt="Goto Line" title="Goto Line">
                                  </a>
                              </td>
                              <td>
                                  <a href=" javascript:find();">
                                      <img src="images/find.png" border="0" alt="Find" Title="Find">
                                  </a>
                              </td>
                              <td>
                                  <a href=" javascript:replace();">
                                      <img src="images/replace.png" border="0" alt="Replace" Title="Replace">
                                  </a>
                              </td>
                              <td>
                                  <a href=" javascript:macroRecord();">
                                      <img id="macro_recorder" src="images/record.png" border="0" alt="Record Macro" title="Record Macro">
                                  </a>
                              </td>
                              <td style="border-right:1px solid #dddddd">
                                  <a href=" javascript:macroPlay();">
                                      <img src="images/play.png" border="0" alt="Play Macro" Title ="Play Macro">
                                  </a>

                              </td>
                          </tr>
                      </table>
                  </div>
                  <div id="code" class="col-md-10"></div>
                  <script>
					var editor = ace.edit("code");
					editor.setTheme("ace/theme/eclipse");
					editor.getSession().setMode("ace/mode/javascript");
					editor.focus();
						  </script>
              </div>
               </div>
            <div id="messages"></div>
            <div>
            	<textarea id="console" readonly="readonly"></textarea>
            </div>

         </div>
      </div>
      <div class="col-md-1">
      </div>
      <script type="text/javascript">
         var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
         document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      </script>
      <script type="text/javascript">
         try {
             var pageTracker = _gat._getTracker("UA-5582165-5");
             pageTracker._trackPageview();
         } catch(err) {}
      </script>
      </div>
   </body>
</html>
